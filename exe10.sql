--EX.10
USE MASTER
CREATE DATABASE MEDSV
USE MEDSV

CREATE TABLE MEDICAMENTOS(
 CODIGO					INT					NOT NULL,
 NOME					VARCHAR(45)			NOT NULL,
 APRESENTACAO  			VARCHAR(35)			NOT NULL,
 UNICAD  				VARCHAR(12)			NOT NULL,
 PRECOPROP				NUMERIC(5,3)		NOT NULL
 PRIMARY KEY (CODIGO)
)
INSERT INTO MEDICAMENTOS
VALUES
(1,'Acetato de medroxiprogesterona','150 mg/ml','Ampola',6.700),
(2,'Aciclovir','200mg/comp.','Comprimido',0.280),
(3,'Ácido Acetilsalicílico','500mg/comp.','Comprimido',0.035),
(4,'Ácido Acetilsalicílico','100mg/comp.','Comprimido',0.030),
(5,'Ácido Fólico','5mg/comp.','Comprimido',0.054),
(6,'Albendazol','400mg/comp. mastigável','Comprimido',0.560),
(7,'Alopurinol','100mg/comp.','Comprimido',0.080),
(8,'Amiodarona','200mg/comp.','Comprimido',0.200),
(9,'Amitriptilina(Cloridrato)','25mg/comp.','Comprimido',0.220),
(10,'Amoxicilina','500mg/cáps.','Cápsula',0.190)

CREATE TABLE CLIENTE(
CPF				CHAR(11)		NOT NULL,
NOME			VARCHAR(40)		NOT NULL,
RUA				VARCHAR(25)		NOT NULL,
NUM				INT				NOT NULL,
BAIRRO			VARCHAR(15)		NOT NULL,
TELEFONE		CHAR(08)		NOT NULL
PRIMARY KEY (CPF)
)

INSERT INTO CLIENTE
VALUES
('34390898700','Maria Zélia','Anhaia',65,'Barra Funda','92103762'),
('21345986290','Roseli Silva','Xv. De Novembro',987,'Centro','82198763'),
('86927981825','Carlos Campos','Voluntários da Pátria',1276,'Santana','98172361'),
('31098120900','João Perdizes','Carlos de Campos',90,'Pari','61982371')

CREATE TABLE VENDA(
NOTAF				INT					NOT NULL,
CPF_CLIENTE			CHAR(11)			NOT NULL,
COD_MED				INT					NOT NULL,
QUANT				INT					NOT NULL,
Val_TOT				NUMERIC(6,2)		NOT NULL,
DAT					DATE				NOT NULL
PRIMARY KEY (NOTAF,CPF_CLIENTE,COD_MED)
FOREIGN KEY (CPF_CLIENTE)
			REFERENCES CLIENTE (CPF),
FOREIGN KEY (COD_MED)
			REFERENCES MEDICAMENTOS (CODIGO)

)
INSERT INTO VENDA
VALUES
(31501,'86927981825',10,3,0.57,'2020-11-01'),
(31501,'86927981825',2,10,2.8,'2020-11-01'),
(31501,'86927981825',5,30,1.05,'2020-11-01'),
(31501,'86927981825',8,30,6.6,'2020-11-01'),
(31502,'34390898700',8,15,3,'2020-11-01'),
(31502,'34390898700',2,10,2.8,'2020-11-01'),
(31502,'34390898700',9,10,2.2,'2020-11-01'),
(31503,'31098120900',1,20,134,'2020-11-02')

--OP1
SELECT MED.NOME,MED.APRESENTACAO,
CASE WHEN (MED.UNICAD = 'Comprimido')
THEN
	SUBSTRING(MED.UNICAD,1,4)+'.'
END
,MED.PRECOPROP
FROM MEDICAMENTOS MED
LEFT OUTER JOIN VENDA V
ON MED.CODIGO = V.COD_MED
WHERE V.COD_MED IS NULL
--OP2
SELECT CL.NOME FROM CLIENTE CL
INNER JOIN VENDA V ON CL.CPF = V.CPF_CLIENTE
INNER JOIN MEDICAMENTOS MED ON MED.CODIGO = V.COD_MED
WHERE MED.NOME = 'Amiodarona'
--OP3
SELECT
CL.CPF,CL.RUA+' '+CAST(CL.NUM AS VARCHAR(05))+' '+CL.BAIRRO AS ENDERECO,
MED.NOME AS 'NOME_DO_REMEDIO',MED.APRESENTACAO,MED.UNICAD,MED.PRECOPROP,
V.QUANT,V.Val_TOT
FROM CLIENTE CL INNER JOIN VENDA V ON V.CPF_CLIENTE = CL.CPF
INNER JOIN MEDICAMENTOS MED ON MED.CODIGO = V.COD_MED
WHERE CL.NOME = 'Maria Zélia'
--OP4
SELECT DISTINCT CONVERT(VARCHAR(08),V.DAT,103) FROM CLIENTE CL INNER JOIN VENDA V 
ON V.CPF_CLIENTE = CL.CPF
WHERE CL.NOME = 'Carlos Campos'
--OP5
UPDATE MEDICAMENTOS
SET NOME = 'Cloridrato de Amitriptilina'
WHERE
NOME = 'Amitriptilina(Cloridrato)' 